*** Settings ***
Library           Selenium2Library
Resource          通用操作封装.txt

*** Keywords ***
Map_SelectBox_给下拉框赋值
    [Arguments]    ${fieldName}    ${value}
    [Documentation]    *功能：*
    ...
    ...    给下拉框字段赋值
    ...
    ...    *参数说明：*
    ...
    ...    fieldName ：需要赋值的input控件的name属性
    ...
    ...    value ：要选中的下拉框文本
    ...
    ...    *示例：*
    ...
    ...    Map_SelectBox_给下拉框赋值|contactType | 三方合同 \ \ \
    Return From Keyword If    '${value}' == '[NULL]' or '${value}' == ''
    #hack popup
    注入PopupMockup脚本
    ${disabled}    Get Element Attribute    //input[@name='${fieldName}']/parent::*/following-sibling::*/img@disabled
    run keyword if    '${disabled}'=='disabled' or '${disabled}'=='true'    fail    封装提示信息：FieldName为"${fieldName}'的下拉框无法编辑
    click image    //input[@name='${fieldName}']/parent::*/following-sibling::*/img
    切入PopupMockup上下文
    #检查选项是否存在
    ${optionExist}    _myExecuteJS    var tds=window.document.getElementsByTagName('td');for(var i=0;i<tds.length;i++){if(tds[i].innerText=='${value}'){return'1|||1';}}return'1|||0';
    run keyword if    '${optionExist}'=='0'    fail    封装提示信息：FieldName为"${fieldName}'的下拉框不存在选项"${value}"，请检查参数是否正确。
    #解决下拉框中选项太多无法点击的问题,先隐藏无关选项，点击结束之后再恢复显示
    Execute Javascript    var tds = window.document.getElementsByTagName('td');for(var i=0;i<tds.length;i++){if(tds[i].innerText != '${value}')tds[i].style.display='none';}
    click element    //td[text()='${value}']/parent::tr
    Execute Javascript    var tds = window.document.getElementsByTagName('td');for(var i=0;i<tds.length;i++){if(tds[i].innerText != '${value}')tds[i].style.display='';}
    #恢复iframe上下文
    Run Keyword And Ignore Error    返回上级Iframe
    #触发span元素Blur事件
    Run Keyword And Ignore Error    Execute Javascript    window.document.getElementById('${fieldName}').fireEvent('onblur');

Map_SelectBox_给下拉框赋值_无Name属性
    [Arguments]    ${spanId}    ${value}
    [Documentation]    *功能：*
    ...
    ...    给下拉框字段赋值（解决input控件没有name属性的场景）
    ...
    ...    *参数说明：*
    ...
    ...    spanId ：最外层span元素的id
    ...
    ...    value ：要选中的下拉框文本
    ...
    ...    *示例：*
    ...
    ...    Map_SelectBox_给下拉框赋值_无Name属性 | Station | 三方合同
    Return From Keyword If    '${value}' == '[NULL]' or '${value}' == ''
    #hack popup
    注入PopupMockup脚本
    ${disabled}    Get Element Attribute    //span[@id='${spanId}']//img@disabled
    run keyword if    '${disabled}'=='disabled' or '${disabled}'=='true'    fail    封装提示信息：spanId为"${spanId}'的下拉框无法编辑
    click image    //span[@id='${spanId}']//img
    切入PopupMockup上下文
    #检查选项是否存在
    ${optionExist}    _myExecuteJS    var tds=window.document.getElementsByTagName('td');for(var i=0;i<tds.length;i++){if(tds[i].innerText=='${value}'){return'1|||1';}}return'1|||0';
    run keyword if    '${optionExist}'=='0'    fail    封装提示信息：spanId为"${spanId}'的下拉框不存在选项"${value}"，请检查参数是否正确。
    #解决下拉框中选项太多无法点击的问题,先隐藏无关选项，点击结束之后再恢复显示
    Execute Javascript    var tds = window.document.getElementsByTagName('td');for(var i=0;i<tds.length;i++){if(tds[i].innerText != '${value}')tds[i].style.display='none';}
    click element    //td[text()='${value}']/parent::tr
    Execute Javascript    var tds = window.document.getElementsByTagName('td');for(var i=0;i<tds.length;i++){if(tds[i].innerText != '${value}')tds[i].style.display='';}
    #恢复iframe上下文
    Run Keyword And Ignore Error    返回上级Iframe
    #触发span元素Blur事件
    Run Keyword And Ignore Error    Execute Javascript    window.document.getElementById('${spanId}').fireEvent('onblur');
